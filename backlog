#!/usr/bin/env php
<?php declare(strict_types=1);
/**
 * This file is part of the backlog-velocity.
 *
 * (c) Yannick Voyer (http://github.com/yvoyer)
 */

namespace {
    require_once 'vendor/autoload.php';

    // todo move to infra namespace, make a symlink in bin on install
    use Star\BacklogVelocity\Agile\Infrastructure\Persistence\Doctrine\DoctrinePlugin;
    use Star\BacklogVelocity\Cli\BacklogApplication;
    use Symfony\Component\Console\Output\ConsoleOutput;
    use Symfony\Component\Yaml\Yaml;

    $output = new ConsoleOutput();
    if (false === file_exists('config.yml')) {
        $message = <<<Message
<error>\n\n
    Config file not present, you must copy the file 'config.yml.template'
    to a 'config.yml' file at the root folder.
\n\n</error>
Message;
        $output->writeln($message);
        exit(1);
    }

    $console = new BacklogApplication($rootPath = __DIR__, $env = 'dev', $config = Yaml::parse(file_get_contents('config.yml')));
    $console->registerPlugin(DoctrinePlugin::bootstrap($config, $env, $rootPath));
    $console->run(null, $output);
}
